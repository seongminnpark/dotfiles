webpackJsonp([13],{0:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _couponChecking=__webpack_require__(829),_couponChecking2=_interopRequireDefault(_couponChecking);(0,_couponChecking2["default"])()},829:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function waitForSelector(selectorFn,cb){var el=selectorFn();if(el)return cb(el);var exponentialBackoff=(0,_backoff.exponential)({randomisationFactor:0,initialDelay:50,maxDelay:1500});exponentialBackoff.backoff(),exponentialBackoff.on("ready",function(){var el=selectorFn();return el?void cb(el):void exponentialBackoff.backoff()})}function buttonsLoaded(){try{var selector=document.querySelector("#honeyContainer").shadowRoot.querySelector("#honey").querySelectorAll("button");return selector.length&&selector}catch(e){return!1}}function ebatesLoaded(){try{return document.querySelector(".ebates-notification")}catch(e){return!1}}function popupLoaded(){return document.querySelector("#honeyContainer")}function addTryCouponsEvtListener(){waitForSelector(buttonsLoaded,function(buttons){var hButton=_lodash2["default"].last(buttons),tryCouponsButtonFound=hasTryCouponsButton(buttons);hButton&&hButton.addEventListener("click",function(){(0,_sendMetric2["default"])("track","honeyFindSavings",{domain:getDomain(),pagePath:location.pathname,url:location.href}),tryCouponsButtonFound&&(0,_sendMetric2["default"])("track","honeyTryCoupons",{domain:getDomain(),pagePath:location.pathname,url:location.href}),(0,_honeyStateCache2["default"])({action:"initSavingsCheck"}),checkUntilTimeout(savingsLoaded,4e4,500,handleHoneySavings)})})}function delay(interval){return new _bluebird2["default"](function(res){setTimeout(res,interval)})}function handleHoneySavings(data){if(data){var savings=data.savings,originalPrice=data.originalPrice;(0,_honeyStateCache2["default"])({action:"endSavingsCheck"}),(0,_sendMetric2["default"])("track","honeySavingsFound",{originalPrice:originalPrice,savings:savings,domain:getDomain(),pagePath:location.pathname,url:location.href}),_state2["default"].set(["warnAboutStandDown"],!0)}}function getDomain(){if(currentDomain)return currentDomain;var domain=location.hostname.replace(/^www\./,"");return domain=(0,_shopify2["default"])(domain)||domain}function hasTryCouponsButton(buttons){return _lodash2["default"].find(buttons,function(button){return/coupon(?:s)?|code(?:s)?/i.test(button.innerHTML)})||_lodash2["default"].find(document.querySelector("#honeyContainer").shadowRoot.querySelector("#honey").querySelectorAll("span"),function(span){return"Coupon codes"===span.innerHTML})}function savingsLoaded(){var result=void 0;return _lodash2["default"].forEach(savingsModalParsers,function(parser){var found=parser();if(_lodash2["default"].has(found,"savings"))return void(result=found)}),result}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=__webpack_require__(1),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(84),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),initHoneyChecking=function(){var _ref=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(){var honeyIsRunning;return _regenerator2["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,_context.next=3,(0,_honeyStateCache2["default"])({action:"getHoneyState"});case 3:honeyIsRunning=_context.sent,honeyIsRunning&&checkUntilTimeout(savingsLoaded,4e4,500,handleHoneySavings),waitForSelector(popupLoaded,function(customEl){addTryCouponsEvtListener();var changeVisibility=_lodash2["default"].debounce(function(visible){(0,_sendMetric2["default"])("track",visible?"showHoney":"hideHoney",{domain:getDomain(),pagePath:location.pathname,url:location.href})},1e3),observer=new MutationObserver(function(mutations){_lodash2["default"].forEach(mutations,function(mutationRecord){var visibility=_lodash2["default"].get(mutationRecord,"target.style.visibility");"hidden"===visibility?changeVisibility(!1):"initial"===visibility&&changeVisibility(!0)})}),target=customEl?customEl.shadowRoot.querySelector("#honey"):null;target&&observer.observe(target,{attributes:!0,attributeFilter:["style"]})}),_context.next=10;break;case 8:_context.prev=8,_context.t0=_context["catch"](0);case 10:case"end":return _context.stop()}},_callee,this,[[0,8]])}));return function(){return _ref.apply(this,arguments)}}(),checkUntilTimeout=function(){var _ref2=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee2(check,timeout,interval,cb){var timeoutID,result;return _regenerator2["default"].wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:timeoutID=setTimeout(cb,timeout),result=check();case 2:if(result){_context2.next=8;break}return _context2.next=5,delay(interval);case 5:result=check(),_context2.next=2;break;case 8:clearTimeout(timeoutID),cb(result);case 10:case"end":return _context2.stop()}},_callee2,this)}));return function(_x,_x2,_x3,_x4){return _ref2.apply(this,arguments)}}(),initEbatesChecking=function(){var _ref3=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee3(){var honeyIsRunning;return _regenerator2["default"].wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,(0,_honeyStateCache2["default"])({action:"getHoneyState"});case 2:honeyIsRunning=_context3.sent,honeyIsRunning||waitForSelector(ebatesLoaded,function(ebates){(0,_sendMetric2["default"])("track","ebatesNotif",{domain:getDomain(),pagePath:location.pathname,url:location.href}),ebates.querySelector(".ebates-notification-button.ebates-notification-button-activate").addEventListener("click",function(){(0,_sendMetric2["default"])("track","ebatesActivate",{domain:getDomain(),pagePath:location.pathname,url:location.href})}),ebates.querySelector(".ebates-notification-close").addEventListener("click",function(){(0,_sendMetric2["default"])("track","ebatesDismiss",{domain:getDomain(),pagePath:location.pathname,url:location.href})})});case 4:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref3.apply(this,arguments)}}(),_lodash=__webpack_require__(143),_lodash2=_interopRequireDefault(_lodash),_sendMetric=__webpack_require__(134),_sendMetric2=_interopRequireDefault(_sendMetric),_bluebird=__webpack_require__(148),_bluebird2=_interopRequireDefault(_bluebird),_honeyStateCache=__webpack_require__(830),_honeyStateCache2=_interopRequireDefault(_honeyStateCache),_state=__webpack_require__(141),_state2=_interopRequireDefault(_state),_shopify=__webpack_require__(831),_shopify2=_interopRequireDefault(_shopify),_backoff=__webpack_require__(781),currentDomain=void 0;exports["default"]=function(domain){currentDomain=domain,initHoneyChecking(),initEbatesChecking()};var savingsModalParsers=[function(){try{var savedRe=/Honey saved you \$([\d\.]+)!/,savings=_lodash2["default"].find(document.querySelector("#honeyContainer").shadowRoot.querySelector("#honey").querySelectorAll("div"),function(div){return savedRe.test(div.innerHTML)}).innerHTML.match(savedRe)[1].replace(".","");if(savings){var originalPrice=document.querySelector("#honeyContainer").shadowRoot.querySelector("#honey").querySelector("strike").innerHTML.replace(".","").replace("$","").replace(",","");return{savings:savings,originalPrice:originalPrice}}}catch(e){return!1}},function(){try{var savedRe=/\$([\d\.]+) saved!/,savings=_lodash2["default"].last(_lodash2["default"].filter(document.querySelector("#honeyContainer").shadowRoot.querySelector("#honey").querySelectorAll("div"),function(div){return savedRe.test(div.innerText)})).innerText.match(savedRe)[1].replace(".","").replace("$","").replace(",","");if(savings){var spans=document.querySelector("#honeyContainer").shadowRoot.querySelector("#honey").querySelectorAll("span"),textIdx=_lodash2["default"].findIndex(spans,function(span){return/original\stotal/i.test(span.innerText)}),originalPrice=spans[textIdx+1].innerText.replace(".","").replace("$","").replace(",","");return{savings:savings,originalPrice:originalPrice}}}catch(e){return!1}},function(){try{return!!/doesn't have working codes/.test(document.querySelector("#honeyContainer").shadowRoot.innerHTML)&&{savings:0,originalPrice:1}}catch(e){return!1}},function(){try{var savedRe=/(You saved).*(\$-)(\d+\.\d+)/,savings=document.querySelector("#honeyContainer").shadowRoot.innerHTML.match(savedRe)[3];if(savings){var originalPriceRe=/(Without Honey)[^\$]+\$(\d+\.\d+)/,originalPrice=document.querySelector("#honeyContainer").shadowRoot.innerHTML.match(originalPriceRe)[2];return{savings:savings,originalPrice:originalPrice}}}catch(e){return!1}}]},830:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _messenger=__webpack_require__(135),_messenger2=_interopRequireDefault(_messenger);exports["default"]=function(data){return(0,_messenger2["default"])("honeyStateCache",data)}},831:function(module,exports){"use strict";function getShopifyDomain(domain){try{var URL=document.URL,shopifyMatch=URL.match(/shopify\.com\/\d+/);if(shopifyMatch)return shopifyMatch[0];if(document.querySelector("#checkout_reduction_code")&&document.querySelector(".payment-due__price")&&document.querySelector(".order-summary__section--discount"))return domain;var chronoMatch=URL.match(/chronotrack\.com\/r\/\d+/);if(chronoMatch)return chronoMatch[0];var analyticsScript=document.querySelector("script.analytics");if(analyticsScript){var match=analyticsScript.innerHTML.match(/\:\{\"shopId\"\:(\d+)\}/);if(match)return"shopify.com/"+match[1]}}catch(e){}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=getShopifyDomain}});