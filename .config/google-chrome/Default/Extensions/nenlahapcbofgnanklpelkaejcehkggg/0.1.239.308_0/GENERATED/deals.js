webpackJsonp([3],{0:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var _regenerator=__webpack_require__(1),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(84),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),checkForDeal=function(){var _ref=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(data){var deal;return _regenerator2["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!data){_context.next=5;break}return _context.next=3,(0,_findDeal2["default"])(data);case 3:deal=_context.sent,deal&&((0,_setBrowserAction2["default"])({active:!0}),_state2["default"].set("dealsView",{deal:deal,queryData:data}),(0,_loadApp2["default"])({initialRoute:"/deals",cssUrl:"GENERATED/deals.css",route:_react2["default"].createElement(_reactRouter.Route,{path:"deals",component:_Deals2["default"]})}));case 5:case"end":return _context.stop()}},_callee,this)}));return function(_x){return _ref.apply(this,arguments)}}(),init=function(){var _ref2=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee2(){var data;return _regenerator2["default"].wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,(0,_deals2["default"])();case 2:data=_context2.sent,checkForDeal(data);case 4:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),_react=__webpack_require__(85),_react2=_interopRequireDefault(_react),_Deals=__webpack_require__(840),_Deals2=_interopRequireDefault(_Deals),_reactRouter=__webpack_require__(315),_loadApp=__webpack_require__(373),_loadApp2=_interopRequireDefault(_loadApp),_setBrowserAction=__webpack_require__(185),_setBrowserAction2=_interopRequireDefault(_setBrowserAction),_findDeal=__webpack_require__(843),_findDeal2=_interopRequireDefault(_findDeal),_state=__webpack_require__(141),_state2=_interopRequireDefault(_state),_deals=__webpack_require__(844),_deals2=_interopRequireDefault(_deals);"loading"!==document.readyState?init():document.addEventListener("DOMContentLoaded",init)},832:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=__webpack_require__(1),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(84),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_lodash=__webpack_require__(143),_lodash2=_interopRequireDefault(_lodash);exports["default"]=function(){function fetchJSON(_x){return _ref.apply(this,arguments)}var _ref=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(url){var resp,json,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _regenerator2["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,fetch(url,_lodash2["default"].merge({headers:{"Content-Type":"application/json","x-wb-cookie":"test"}},options));case 2:return resp=_context.sent,_context.next=5,resp.json();case 5:if(json=_context.sent,resp.ok){_context.next=8;break}throw new Error(json);case 8:return _context.abrupt("return",json);case 9:case"end":return _context.stop()}},_callee,this)}));return fetchJSON}()},840:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=__webpack_require__(1),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(84),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_getPrototypeOf=__webpack_require__(92),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=__webpack_require__(96),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=__webpack_require__(97),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=__webpack_require__(100),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(102),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(85),_react2=_interopRequireDefault(_react),_reactMotion=__webpack_require__(103),_baobab=__webpack_require__(121),_sendMetric=__webpack_require__(134),_sendMetric2=_interopRequireDefault(_sendMetric),_lodash=__webpack_require__(143),_lodash2=_interopRequireDefault(_lodash),_currency=__webpack_require__(811),_currency2=_interopRequireDefault(_currency),_nodeUuid=__webpack_require__(387),_fetchJSON=__webpack_require__(832),_visitDeal=(_interopRequireDefault(_fetchJSON),__webpack_require__(841)),_visitDeal2=_interopRequireDefault(_visitDeal);__webpack_require__(842);var Deals=function(_Component){function Deals(){var _ref;(0,_classCallCheck3["default"])(this,Deals);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var _this=(0,_possibleConstructorReturn3["default"])(this,(_ref=Deals.__proto__||(0,_getPrototypeOf2["default"])(Deals)).call.apply(_ref,[this].concat(args)));return _this.state={hideNotification:!0},_this}return(0,_inherits3["default"])(Deals,_Component),(0,_createClass3["default"])(Deals,[{key:"componentDidMount",value:function(){var _this2=this;(0,_sendMetric2["default"])("page","dealsNotification",{view:"dealsNotification",type:"notification",domain:location.hostname.replace(/^www\./,""),pagePath:location.pathname,offerSignUp:_lodash2["default"].get(this.props.view,"offerSignUp"),qualified:_lodash2["default"].get(this.props.view,"qualified",!1),balance:_lodash2["default"].get(this.props.view,"balance",0)}),setTimeout(function(){_this2.setState({hideNotification:!1})},1e3)}},{key:"render",value:function(){var _this3=this,hideNotification=this.state.hideNotification,_$get=_lodash2["default"].get(this.props,"view.deal",{}),title=_$get.title,discount=_$get.discount,showOnTop=!0,showOnRight=!0;return _react2["default"].createElement("div",{className:hideNotification?"disabled deals-page":"deals-page",style:{top:showOnTop?"0":"auto",bottom:showOnTop?"auto":"0",left:showOnRight?"auto":"0",right:showOnRight?"0":"auto"}},_react2["default"].createElement(_reactMotion.Motion,{style:{opacity:(0,_reactMotion.spring)(hideNotification?0:1,{stiffness:180,damping:20}),y:(0,_reactMotion.spring)(hideNotification?showOnTop?-100:100:0,{stiffness:180,damping:20})}},function(_ref2){var opacity=_ref2.opacity,y=_ref2.y;return _react2["default"].createElement("div",{className:"deals-notification",style:{transform:"translate3d(0,"+y+"%,0)",opacity:""+opacity}},_react2["default"].createElement("header",null,_react2["default"].createElement("div",{className:"w-icon-logo"},_this3.renderWIcon())),_react2["default"].createElement("section",null,_react2["default"].createElement("h2",null,title),_react2["default"].createElement("h4",null,"save ",(0,_currency2["default"])(discount,!0)," at ",_lodash2["default"].get(_this3.props,"view.queryData.title")),_react2["default"].createElement("div",{className:"button-wrapper"},_react2["default"].createElement("button",{className:"primary-btn-large",onClick:_this3.onClickDeal.bind(_this3)},"view on Groupon")),_react2["default"].createElement("h4",{className:"bold maybe-later tertiary-link",onClick:_this3.onClosePopup.bind(_this3,"no thanks")},"no thanks")))}))}},{key:"onClickDeal",value:function(){function onClickDeal(){return _ref3.apply(this,arguments)}var _ref3=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(){var clickId,redirect;return _regenerator2["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:clickId=(0,_nodeUuid.v4)(),(0,_sendMetric2["default"])("trackClick","viewGrouponDeal","view deal",{domain:location.hostname.replace(/^www\./,""),pagePath:location.pathname,clickId:clickId}),redirect=_lodash2["default"].get(this.props,"view.deal.url")+"&wid="+encodeURIComponent(location.hostname)+"&clickId="+clickId,(0,_visitDeal2["default"])({redirect:redirect});case 4:case"end":return _context.stop()}},_callee,this)}));return onClickDeal}()},{key:"onClosePopup",value:function(label){this.setState({hideNotification:!0}),(0,_sendMetric2["default"])("trackClick","dismissDealsNotification",label,{domain:location.hostname.replace(/^www\./,""),pagePath:location.pathname})}},{key:"renderWIcon",value:function(){return _react2["default"].createElement("svg",{id:"Layer_1",x:"0px",y:"0px",viewBox:"0 0 60 45"},_react2["default"].createElement("g",null,_react2["default"].createElement("path",{d:"M39.4,35.9h-9L25,19.1h-0.1l-5.2,16.8h-9L1.3,8.8h9.6L15.7,26h0.1l4.9-17.2h8.9l5,17.2h0.1l4.8-17.2h9.3 L39.4,35.9z M57.7,31.6c0,0.7-0.1,1.4-0.4,2c-0.2,0.6-0.6,1.1-1,1.6c-0.4,0.4-1,0.8-1.7,1s-1.3,0.3-2,0.3c-1.5,0-2.7-0.5-3.7-1.4 c-1-0.9-1.4-2-1.4-3.5c0-0.7,0.1-1.3,0.4-1.8c0.2-0.7,0.6-1.3,1-1.6c0.8-0.7,1.4-1,1.7-1.1c0.9-0.3,1.6-0.4,2-0.4 c0.7,0,1.4,0.1,2,0.4c0.7,0.2,1.2,0.6,1.7,1c0.3,0.3,0.7,0.8,1.1,1.6C57.6,30.2,57.7,30.8,57.7,31.6z"})))}}]),Deals}(_react.Component);exports["default"]=(0,_baobab.branch)({view:["dealsView"],events:["events"],session:["session"]},Deals)},841:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _messenger=__webpack_require__(135),_messenger2=_interopRequireDefault(_messenger);exports["default"]=function(data){return(0,_messenger2["default"])("visitDeal",data)}},842:196,843:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _messenger=__webpack_require__(135),_messenger2=_interopRequireDefault(_messenger);exports["default"]=function(data){return(0,_messenger2["default"])("findDeal",data)}},844:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function initSite(){try{var domain=_tldjs2["default"].getDomain(window.location.href),result=__webpack_require__(845)("./"+domain+"/index");if(result)return result["default"]()}catch(e){return{error:"Site not supported"}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=initSite;var _tldjs=__webpack_require__(429),_tldjs2=_interopRequireDefault(_tldjs)},845:function(module,exports,__webpack_require__){function webpackContext(req){return __webpack_require__(webpackContextResolve(req))}function webpackContextResolve(req){return map[req]||function(){throw new Error("Cannot find module '"+req+"'.")}()}var map={"./google.com/index":846,"./opentable.com/index":847,"./yelp.com/index":848};webpackContext.keys=function(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=845},846:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function getLatLong(){try{var latLong=(0,_regex2["default"])(/@([-0-9.]+,[-0-9.]+)/,latLongEl.href);if(latLong&&latLong.length){var components=latLong.split(","),latitude=components[0],longitude=components[1],title=document.querySelector('#rhs_block [role="heading"] > div').innerText.replace(/Saved to your Map View on Map/i,"").trim(),website=document.querySelector('#rhs_block [role="heading"] .ab_button').href,address=document.querySelector('#rhs_block [data-md="1002"] ._eFb ._Xbe').innerText.trim(),phone=document.querySelector('#rhs_block [data-md="1006"] ._eFb ._Xbe').innerText.trim();return{latitude:latitude,longitude:longitude,title:title,website:website,address:address,phone:phone}}}catch(e){}}function checkForLatLong(){return latLongEl?void observer.disconnect():(latLongEl=document.querySelector("#rhs_block .kp-header .kno-fb-ctx div > a[tabindex]"),latLongEl?getLatLong():void 0)}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=__webpack_require__(1),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(84),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_regex=__webpack_require__(146),_regex2=_interopRequireDefault(_regex),_bluebird=__webpack_require__(148),_bluebird2=_interopRequireDefault(_bluebird),observer=void 0,latLongEl=void 0;exports["default"]=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(){var data,target;return _regenerator2["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if("www.google.com"===window.location.hostname){_context.next=2;break}return _context.abrupt("return");case 2:if(data=checkForLatLong(),!data){_context.next=5;break}return _context.abrupt("return",data);case 5:if(target=document.getElementById("main"),!target){_context.next=8;break}return _context.abrupt("return",new _bluebird2["default"](function(resolve){observer=new MutationObserver(function(mutations){var data=checkForLatLong();data&&resolve(data)}),observer.observe(target,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}));case 8:case"end":return _context.stop()}},_callee,void 0)}))},847:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function getContent(selector){try{var el=document.querySelector(selector);if(el)return el.getAttribute("content")}catch(e){}}function parseOpenTable(){try{var latitude=getContent('[property="place:location:latitude"]');if(latitude){var longitude=getContent('[property="place:location:longitude"]'),title=getContent('[property="og:description"]').split(",")[0],website=getContent('[property="business:contact_data:website"]'),address=getContent('[property="business:contact_data:street_address"]'),phone=getContent('[property="business:contact_data:phone_number"]');return{latitude:latitude,longitude:longitude,title:title,website:website,address:address,phone:phone}}}catch(e){}}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=__webpack_require__(1),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(84),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);exports["default"]=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(){return _regenerator2["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",parseOpenTable());case 1:case"end":return _context.stop()}},_callee,void 0)}))},848:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function parseYelp(){try{var latLongEl=document.querySelector("[data-map-state]");if(latLongEl){var data=JSON.parse(latLongEl.getAttribute("data-map-state")),latitude=data.center.latitude,longitude=data.center.longitude,title=document.querySelector("h1").innerText.trim(),website=document.querySelector(".biz-website a").innerText.toLowerCase().trim(),address=document.querySelector(".street-address").innerText.trim(),phone=document.querySelector(".biz-phone").innerText.trim();return{latitude:latitude,longitude:longitude,title:title,website:website,address:address,phone:phone}}}catch(e){}}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=__webpack_require__(1),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(84),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);exports["default"]=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(){return _regenerator2["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",parseYelp());case 1:case"end":return _context.stop()}},_callee,void 0)}))}});